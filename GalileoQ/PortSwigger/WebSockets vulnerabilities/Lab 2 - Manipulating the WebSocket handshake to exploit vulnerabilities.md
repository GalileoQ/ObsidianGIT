`TAREA:` Esta tienda en línea tiene una función de chat en vivo implementada mediante WebSockets. Tiene un filtro XSS agresivo pero defectuoso. Para resolver el laboratorio, use un mensaje WebSocket para activar un `alert()`ventana emergente en el navegador del agente de soporte.

iniciamos sesión y vamos al chat. ya sabemos que nuestro payload para intentar generar un `'alert'` es 

```python
<img src=1 onerror='alert(1)'>
```

en este caso el servidor detecta que es un ataque XSS y directamente bloquea nuestra solicitud
![[Pasted image 20250729101900.png]]

podemos interceptar esta solicitud y mirar como se comporta.
![[Pasted image 20250729102302.png]]

miramos el `WebSockets history` y vemos las solicitudes de parte del servidor y del cliente. así que vamos a usar una de estas para enviarlas al repeater
![[Pasted image 20250729121737.png]]

en el repeater podemos enviar al servidor un mensaje con nuestro payload XSS pero el servidor lo detecta como malicioso y bloquea nuestra IP 
![[Pasted image 20250729121907.png]]

para solucionar este problema tenemos una opción para reconectar. esto nos muestra la request y podemos modificar la cabecera para intentar engañar al servidor modificando la dirección IP desde la cabecera. en este caso es con el parametro

```python
X-Forwarded-For: IP
```

después de modificar la cabecera y agregar una IP reconecta al servidor y podemos hablar de nuevo sin problemas
![[Pasted image 20250729122107.png]]

para solucionar el laboratorio debemos realizar diferentes pruebas con las inyecciones XSS hasta encontrar una que pueda baypasear el filtro y sea ejecutada por el servidor. en este caso usamos la variante

```python
<img src=1 oNeRrOr=alert`1`>
```

con esto podemos baypasear el filtro y hacer que el servidor interprete el `alert` y de esta manera tenemos una inyección XSS exitosa
![[Pasted image 20250729122600.png]]

el servidor recibe la inyección XSS se desconecta el `Live Chat` y luego se conecta de nuevo. esto sucede porque al generar el `alert` el servidor se desconecta. pero inmediatamente conecta de nuevo
![[Pasted image 20250729124408.png]]