Para probar la contaminación de los parámetros del lado del servidor en la cadena de consulta, (server-side parameter pollution in a query string) coloque caracteres de sintaxis de consulta como `#`, `&`, y `=` en su entrada y observe cómo responde la aplicación.

Considere una aplicación vulnerable que le permite buscar a otros usuarios basándose en su nombre de usuario. Al buscar un usuario, su navegador realiza la siguiente solicitud:

`GET /userSearch?name=peter&back=/home`

Para recuperar información del usuario, el servidor consulta una API interna con la siguiente solicitud:

`GET /users/search?name=peter&publicProfile=true`

------------------------------------------------------
Tarea: Para resolver el laboratorio, inicie sesión como `administrator`y eliminar `carlos`.


ok lo primero que haremos es ir a la cuenta. tenemos el usuario administrador pero no tenemos credenciales así que vamos a darle en `Forgot password?` 
![[Pasted image 20250701120948.png]]

observamos que esta haciendo una solicitud a un `ForgotPassword?.js` vamos a analizar.
![[Pasted image 20250701121948.png]]

de esta manera tanto inspeccionando la web como capturando la solicitud con el burpsuite podemos ver que el archivo `ForgotPassword?.js` contiene una función que hace una validación del parámetro Forgot-Password. `?reset_token=${resetToken}`: Esta parte indica que se está enviando un parámetro llamado `reset_token` a través de la URL. y luego obtiene  `${resetToken}` que es un marcador de posición que se reemplaza con un token único generado por el servidor cuando el usuario solicita el restablecimiento de contraseña.

es decir cuando un usuario solicita restablecer su contraseña, el servidor genera un token único,  `reset_token`, y luego envía esta URL al usuario por correo electrónico o mensaje, permitiéndole acceder a una página donde puede establecer una nueva contraseña. así que vamos a intentar obtener este token 
![[Pasted image 20250701120126.png]]

lo primero que vamos a probar es intentar forzar el valor del parámetro `reset_token` para poder realizar esto debemos inyectar algunos caracteres para seguir la sintaxis en este caso usaremos el carácter `&` pero debemos url-encodearlo podemos seleccionarlo hacer clic derecho y url-encode o simplemente seleccionamos y luego `Ctrl + u` esto nos da el carácter `%26` que seria el valor codificado. luego pasamos el parámetro `reset_token=123` con esto tratamos de forzar que el valor del token sea `123` 

Tenemos una respuesta `400` la cual nos indica que la solicitud es incorrecta. esto es bueno en parte ya q podemos ver que efectivamente estamos  inyectando una `query string` pero por ahora es invalida
![[Pasted image 20250701123239.png]]

vamos a probar otro carácter en este caso el `#` también url-encodeado que seria el valor `%23` y enviamos un texto como prueba. esto nos da un mensaje de respuesta `400` pero en este caso el servidor nos proporciona información: `"error": "Field not specified."` en español seria `"error": "Campo no especificado."` lo que sugiere que debemos especificar el parámetro `field`
![[Pasted image 20250701124150.png]]

ok. seguimos realizando pruebas y probamos nuevamente con el carácter `&` url-encodeado que seria igual a `%26` y luego le pasamos el parámetro `field` el cual le vamos a decir que es igual a `reset_token` y lo tenemos. hemos hecho una contaminación de los parámetros del lado del servidor (server-side parameter pollution) hemos contaminado los parámetros que recibe el servidor para manipular el comportamiento obteniendo un token valido de parte del servidor 
![[Pasted image 20250701125005.png]]

vamos a inyectar e
![[Pasted image 20250701125456.png]]